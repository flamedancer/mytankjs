<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta name="viewport" charset="utf-8" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <title>魔力坦克</title>
</head>
<body>
<div class="row container-fluid" >
    <div class="col-md-4 room" id="romm_table">
        <div class="row" id='title'>
        《魔力坦克ONLINE》
        </div>
        <div class="row" id='self_room'>
        </div>
        <div class="row">
        	<div class="col-md-4 room can_click" onclick="join(0);">
                 单机练习
            </div>
        	<div class="col-md-4 room can_click" onclick="join(2, '');">
                新建房间
            </div>
        	<div class="col-md-4 room">
                Ping:<span class="label label-default" id="self_ping">35</span>ms
            </div>
        </div>
		<div class="row">
			<div class="col-md-12 room">
			    <div class="row">
			      <div class="col-md-3 room">
			        房间号
			      </div>
			      <div class="col-md-3 room">
			        玩家数
			      </div>
			      <div class="col-md-3 room">
			        ping
			      </div>
			      <div class="col-md-3 room can_click" onclick="join(2, '-1')">
			       快速加入
			      </div>
			    </div>
			</div>
		</div>
	</div>
    <div class="col-md-5">
		<div id="game"></div>
		<div class="progress">
		  <div id="bosshps" class="progress-bar progress-bar-danger" role="progressbar" >
		  </div>
		</div>
	</div>
    <div class="col-md-3" id="contactme">
        <div class="row">
            <div class="panel panel-default">
              <div class="panel-heading">简介</div>
              <div class="panel-body">
              欢迎各位数值、策划、美术、程序等大神吐槽
              </div>
            </div>
        </div>
        <div class="row" id="weixinmsg">
        联系我(微信)：
        </div>
        <div class="row" id="weixindiv">
            <img src="assets/myweixin.png" id="weixin">
        </div>
        <div class="row" id="chatlink">
            <a href="http://flamedancer.cn:7000/" target="_blank">吐槽请点我-_-</a>
        </div>
    </div>
</div>

</body>
<style type="text/css"> 
/*body{ text-align:center} */
.button_span {width: 100%;}
#romm_table {margin-top:5%;}
#game{ margin:0 auto; border:1px solid blue;} 
.room{ margin:0 auto; border:1px solid #0000CD;text-align:center;}
#title {font-size:larger}
#weixin {max-width: 150px; max-height:150px;}
#contactme {text-align:center;}
#chatlink {padding: 20%;}
.can_click {font-weight: bold;font-style:oblique;color:red;text-decoration:blink; }
.can_click:link    {color:blue;}
.can_click:visited {color:blue;}
.can_click:hover   {color:red; cursor:pointer;}
.can_click:active  {color:yellow;}
</style>

<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

<!-- Optional theme -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">
<script src="http://cdn.bootcss.com/jquery/1.11.1/jquery.min.js"></script>
<!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<script type="text/javascript" src="crafty-min.js"></script>
<script type="text/javascript" src="conf.js"></script>
<script type="text/javascript" src="tool.js"></script>
<script type="text/javascript" src="assets/maps/mapjs.js"></script>
<script type="text/javascript" src="libs.js"></script>
<script type="text/javascript" src="control.js"></script>
<script type="text/javascript" src="socket.js"></script>
<script type="text/javascript" src="stage.js"></script>
<script type="text/javascript" src="bullet.js"></script>
<script type="text/javascript" src="tanks.js"></script>
<script type="text/javascript">
    function show_self_ping(ping_value) {
    	$("#self_ping").html(ping_value);
    }

    function addRoom(room_id, room_index, ping) {
        var ping = ping ? ping.toString() : "--";
	    var txt1=$("<div></div>");            // 以 HTML 创建新元素
	    var txt2=$("<div></div>");  // 以 jQuery 创建新元素
	    var txt3=$("<div></div>");  // 以 DOM 创建新元素
	    var txt4=$("<div></div>");
	    var row=$("<div></div>");
	    row.attr("class", "row");
	    row.attr("room_index", room_index);
	    txt1.attr("class", "col-md-3 room");
	    txt2.attr("class", "col-md-3 room");
	    txt3.attr("class", "col-md-3 room");
	    txt4.attr("class", "col-md-3 room can_click");
	    txt4.attr("onclick", "join(2, '" + room_id.toString() + "')");
	    txt1.html(room_index);
	    txt2.html("1/2");
	    txt3.html(ping + "ms");
	    txt4.html("加入");
	    row.append(txt1,txt2,txt3,txt4); 
	    $("#romm_table").append(row);
    }

    function add_rooms(infs) {
        $("[room_index]").each(function(i) {
            this.remove();
        });
        for (var index in infs ) {
            // 可能有空房间
            if (infs[index]) {
                var room_id = infs[index][0];
                var room_ping = infs[index][1];
                addRoom(room_id, index, room_ping);
            }
        }
    }

    function delRoom(room_index) {
    	$("[room_index='"+ room_index +"']").remove();
    }

    function reset_room(room_index, type, value) {
    	if (type == "num") {
    		if (value == 1)
    			$("[room_index='"+ room_index +"']").children(".col-md-3")[3].innerHTML = "加入";
    		else
    			$("[room_index='"+ room_index +"']").children(".col-md-3")[3].innerHTML = "";
    	    $("[room_index='"+ room_index +"']").children(".col-md-3")[1].innerHTML = value.toString()+"/2";
    	}
    	else if (type == "ping")
    	    $("[room_index='"+ room_index +"']").children(".col-md-3")[2].innerHTML = value.toString()+"ms";
    	else if (type == "del")
    		delRoom(room_index);
    	else if (type == "add")
    		addRoom(value, room_index);
    }

    function join(game_model, room_id) {
    	start_game(game_model, room_id);
    }

    function show_self_room(room_index) {
        if (typeof room_index == "undefined") {
            $("#self_room").html("");
        }
        else {
            var info = "正在房间：" + room_index.toString();
            $("#self_room").html(info);
        }
    }

    Crafty.init(SCREEN_WIDTH, SCREEN_HEIGHT, document.getElementById('game'));
    join(0);
</script>
</html>
